<!DOCTYPE html>

<html lang="en">
{% load static %}
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hermes Link</title>
  <link rel="stylesheet" href="/static/css/output.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- Favicon setup -->
  <link rel="apple-touch-icon" sizes="180x180" href={% static 'pics/apple-touch-icon.png' %}>
  <link rel="icon" type="image/png" sizes="32x32" href={% static 'pics/favicon-32x32.png' %}>
  <link rel="icon" type="image/png" sizes="16x16" href={% static 'pics/favicon-16x16.png' %}>
  <link rel="manifest" href={% static 'site.webmanifest' %}>
</head>

<body class="min-h-screen max-w-6xl w-full mx-auto  px-4 md:px-16 bg-black text-white transition-all duration-300 font-sans flex flex-col">
  {% load accounts_extras %}
  
  <div class="flex-grow flex flex-col">
    <!-- Navbar -->
    <nav class="w-full py-4 relative z-20">
      <div class="flex justify-between items-center">
        <div class="flex items-center gap-2">
          <!-- Mobile menu toggle button - only visible on small screens -->
          <button id="sidebar-toggle" class="sm:hidden text-white focus:outline-none">
            <i class="bi bi-list text-4xl"></i>
          </button>
          
          <a href="{% url 'main:index' %}" class="text-4xl sm:text-6xl font-extrabold">
            HL
          </a>
        </div>
        
        <div class="flex gap-2">
          {% if user.is_authenticated %}
            <span class="text-{{ user.gang | gang_color }}-500 font-bold">{{ user.get_username }}</span>
            <a href="{% url 'accounts:logout' %}" class="text-gray-600 hover:text-white transition-colors duration-200">logout</a>
          {% else %}
            <a href="{% url 'login' %}" class="text-white hover:text-blue-500 transition-colors duration-200">login</a>
          {% endif %}
        </div>
      </div>
    </nav>

    <div class="flex flex-grow relative pb-6 sm:pb-12">
      <!-- Sidebar - hidden by default on mobile, toggle with JavaScript -->
      <aside id="sidebar" class="fixed sm:relative py-6 z-30 top-0 left-0 w-60 sm:w-44 md:w-56 -ml-64 sm:ml-0 bg-black sm:bg-transparent flex-shrink-0 pt-20 sm:pt-6">
        <div class="space-y-6 px-4 sm:px-0">
          <div>
            <a href="{% url 'main:index' %}" class="font-bold uppercase">Home</a>
          </div>
          <div>
            <span class="font-bold uppercase">Configurations</span>
            <ul class="mt-2 space-y-1">
              <li>
                <a href="{% url 'configs:history' %}" class="flex items-center p-2 hover:bg-gray-900 rounded">
                  <i class="bi bi-search"></i>
                  <span class="ml-3">History</span>
                </a>
              </li>
              <li>
                <a href="{% url 'configs:upload' %}" class="flex items-center p-2 hover:bg-gray-900 rounded">
                  <i class="bi bi-cloud-upload"></i>
                  <span class="ml-3">Upload</span>
                </a>
              </li>
              <li>
              {% if request.session.config_data %}
                <a href="{% url 'configs:test' %}" class="flex items-center p-2 hover:bg-gray-900 rounded">
                  <div class="relative">
                    <i class="bi bi-lightning-charge"></i>
                    {% if request.session.test_status == 0 %}
                      <i class="bi bi-circle-fill text-green-500 text-[10px] absolute -top-2 -right-2"></i>
                    {% elif request.session.test_status == 1 %}
                      <i class="bi bi-circle-fill text-yellow-500 text-[10px] absolute -top-2 -right-2 animate-pulse"></i>
                    {% elif request.session.test_status == 2 %}
                      <i class="bi bi-circle-fill text-red-500 text-[10px] absolute -top-2 -right-2 animate-pulse"></i>
                    {% endif %}
                  </div>
                  <span class="ml-3">Test</span>
                </a>
              {% else %}
                <div class="flex items-center p-2 text-gray-400 cursor-not-allowed rounded">
                  <div class="relative">
                    <i class="bi bi-lightning-charge"></i>
                    {% if request.session.test_status == 0 %}
                      <i class="bi bi-circle-fill text-green-500 text-[10px] absolute -top-2 -right-2"></i>
                    {% elif request.session.test_status == 1 %}
                      <i class="bi bi-circle-fill text-yellow-500 text-[10px] absolute -top-2 -right-2 animate-pulse"></i>
                    {% elif request.session.test_status == 2 %}
                      <i class="bi bi-circle-fill text-red-500 text-[10px] absolute -top-2 -right-2 animate-pulse"></i>
                    {% endif %}
                  </div>
                  <span class="ml-3">Test</span>
                </div>
              {% endif %}
              </li>
              <li>
              {% if request.session.config_data %}
                <a href="{% url 'configs:submit' %}" class="flex items-center p-2 hover:bg-gray-900 rounded">
                  <i class="bi bi-send"></i>
                  <span class="ml-3">Submit</span>
                </a>
              {% else %}
                <div class="flex items-center p-2 text-gray-400 cursor-not-allowed rounded">
                  <i class="bi bi-send"></i>
                  <span class="ml-3">Submit</span>
                </div>
              {% endif %}
              </li>
            </ul>
          </div>

          <div>
            <a href="/grafana/d/sensor-data" class="font-bold uppercase">Dashboards</a>
          </div>
        </div>
      </aside>

      <!-- Overlay for mobile when sidebar is open -->
      <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden sm:hidden" onclick="toggleSidebar()"></div>

      <!-- Main Content -->
      <div class="flex-1 py-6 sm:ml-8">
        {% block content %}{% endblock %}
      </div>
    </div>

    <!-- Footer -->
    <footer class="w-full flex flex-col items-center pb-6 text-xs text-gray-500 text-mono">
      <!-- Status indicators -->
      <div class="flex gap-4 sm:gap-16 mb-2">
        {% if services %}
          {% for service, status in services %}
            <div class="flex items-center">
              <span class="mr-1">{{ service }}</span>
              <div class="status-dot {% if status == 0 %}status-dot-green animate-pulse{% elif status == 1 %}status-dot-red{% else %}status-dot-yellow{% endif %}"></div>
            </div>
          {% endfor %}
        {% endif %}
      </div>

      <!-- Main footer content -->
      <div class="flex flex-col sm:flex-row items-center gap-2 sm:gap-6">
        <img src="{% static 'pics/logo_H_white.png' %}" class="h-12 hidden sm:block object-scale-down">

        <div class="flex flex-row justify-center sm:text-center sm:flex-col gap-4 sm:gap-0">
          <a href="https://github.com/peppedilillo/hermeslink" class="transition-colors duration-300 hover:text-white">code</a>
          <a href="https://www.hermes-sp.eu/" class="transition-colors duration-300 hover:text-white">hermes</a>
          <a class="cursor-default">about</a>
        </div>

        <div class="w-full sm:w-52 text-center">
          Hermes Link is a web application developed at <span class="text-nowrap">ASI-SSDC</span> for the HERMES collaboration.
          <a href="https://github.com/peppedilillo/" class="transition-colors duration-300 hover:text-white">~p25</a>
        </div>

        <img src="{% static 'pics/bulletsticker.png' %}" class="h-10 sm:h-8 pt-4 sm:pt-0 object-scale-down">
      </div>
    </footer>

  <!-- JavaScript for sidebar toggle -->
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      
      // Check if sidebar is currently visible
      const isSidebarVisible = sidebar.classList.contains('ml-0');
      
      if (isSidebarVisible) {
        // Hide sidebar
        sidebar.classList.remove('ml-0');
        sidebar.classList.remove('min-h-screen');
        sidebar.classList.add('-ml-64');
        overlay.classList.add('hidden');
      } else {
        // Show sidebar
        sidebar.classList.add('ml-0');
        sidebar.classList.add('min-h-screen');
        sidebar.classList.remove('-ml-64');
        overlay.classList.remove('hidden');
      }
    }

    // Add click event to sidebar toggle button
    document.getElementById('sidebar-toggle').addEventListener('click', toggleSidebar);
  </script>
</body>
</html>